paths:
  scryfall_dir: ./data/scryfall_images/subsets/train_500_en_de_cam
  camera_dir: ./data/camera_images
  models_dir: ./models
  embeddings_dir: ./embeddings
  output_dir: ./output_matches
  debug_dir: ./debug

images:
  full_card_size: [224, 320]
  full_crop:
    x_min: 0.0
    y_min: 0.0
    x_max: 1.0
    y_max: 1.0
    keep_aspect: true

camera:
  card_roi:
    x_min: 0.0
    y_min: 0.0
    x_max: 1.0
    y_max: 1.0
  debug_crops:
    enabled: false
    save_limit: 10
    output_dir: ./debug/domain_preview

recognition:
  top_k: 3
  threshold: 0.55
  use_ocr: false

encoder:
  type: resnet18
  emb_dim: 1024

training:
  coarse:
    model_filename: encoder_coarse_500.pt
    batch_size: 128
    epochs: 50
    lr: 0.00035
    num_workers: 8
    cache_images: false
    cache_size: 3000
    scheduler:
      type: warmup_cosine
      warmup_epochs: 2
      warmup_start_factor: 0.2
      min_lr: 5.0e-5
    augment:
      rotation_deg: 1
      brightness: [0.85, 1.15]
      contrast: [0.85, 1.15]
      blur_prob: 0.05
      noise_std: 0.01
  fine:
    batch_size: 128
    epochs: 6
    lr: 0.00012
    margin: 0.4
    freeze_ratio: 0.4
    triplet_weight: 1.0
    ce_weight: 0.3
    num_workers: 8
    cache_images: true
    cache_size: 4000
    use_camera_images: false
    hard_negatives:
      enabled: false
      top_k: 20
      file: "debug/hard_negatives_500.json"
    scheduler:
      type: warmup_cosine
      warmup_epochs: 2
      warmup_start_factor: 0.2
      min_lr: 2.0e-5
    augment:
      camera_like: false
      camera_like_strength: 1.0
      brightness: [0.90, 1.10]
      contrast: [0.90, 1.10]
      saturation: [0.90, 1.10]
      color_temperature_range: [0.93, 1.07]
      gamma_range: [0.93, 1.07]
      rotation_deg: 1.0
      perspective: 0.0
      shadow: 0.0
      noise_std: 0.01
      blur_prob: 0.05

database:
  sqlite_path: tcg_database/database/karten.db
  scenario: train500
  clear_all_embeddings: true

vector:
  dimension: 1024

model:
  embed_dim: 1024

hardware:
  use_cuda: true

embedding_export_runtime:
  model_path: ./models/encoder_fine_500.pt
  use_augmentations: true
  num_augmentations: 4
  use_centroid: true
  append_individual: false
  append_centroid: false
  export_batch_size: 64
  num_workers: 4

embedding_export_analysis:
  model_path: ./models/encoder_fine_500.pt
  use_augmentations: true
  num_augmentations: 2
  use_centroid: false
  append_individual: true
  append_centroid: true
  export_batch_size: 32
  num_workers: 4

analysis:
  oracle_summary_file: "debug/oracle_cluster_summary_500.json"

pipeline:
  scenario: full_no_hardneg
  scenarios:
    final_500_no_hardneg:
      - fine
      - export_runtime_fine
      - export_analysis_fine
      - analyze_embeddings
      - oracle_analysis_final
    full_no_hardneg:
      - coarse
      - fine
      - export_runtime_fine
      - export_analysis_fine
      - oracle_analysis_final
      - analyze_embeddings
    full:
      - coarse
      - export_analysis_coarse
      - oracle_analysis_for_hardneg
      - build_hard_negatives
      - fine
      - export_runtime_fine
      - export_analysis_fine
      - analyze_embeddings
      - oracle_analysis_final
    fast_debug:
      - coarse
      - fine
      - export_runtime_fine
    only_export_runtime:
      - export_runtime_fine
